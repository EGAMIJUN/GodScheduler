# services:
#   # 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (SQL Server)
#   db:
#     image: mcr.microsoft.com/azure-sql-edge
#     container_name: god_scheduler_db
#     user: root
#     ports:
#       - "1433:1433"
#     environment:
#       - ACCEPT_EULA=Y
#       - MSSQL_SA_PASSWORD=GodScheduler2026
#     volumes:
#       - sql_data_edge:/var/opt/mssql/data

#   # 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API (.NET)
#   api:
#     # ğŸ‘‡ ã“ã“ã‹ã‚‰å¤‰æ›´ï¼Dockerfileã‚’ä½¿ã‚ãšã€SDKã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç›´æ¥ä½¿ã†ãƒã‚¤ï¼
#     image: mcr.microsoft.com/dotnet/sdk:9.0
#     container_name: god_scheduler_api
#     ports:
#       - "5078:8080"
#     environment:
#       - ASPNETCORE_ENVIRONMENT=Development
#       - ConnectionStrings__DefaultConnection=Server=db;Database=GodSchedulerDb;User Id=sa;Password=GodScheduler2026;TrustServerCertificate=True;
#       # ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ç”¨ã®è¨­å®š
#       - DOTNET_USE_POLLING_FILE_WATCHER=true
#     depends_on:
#       - db
#     working_dir: /app
#     # ğŸ‘‡ ã“ã‚ŒãŒæœ€å¼·ã®å‘ªæ–‡ï¼ã€Œç›£è¦–ã—ã¦(watch)ã€å®Ÿè¡Œã›ã‚ˆ(run)ã€
#     command: dotnet watch run --urls=http://0.0.0.0:8080
#     volumes:
#       - ./GodScheduler.Api:/app
#       - /app/obj
#       - /app/bin

#   # 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Next.js)
#   web:
#     build:
#       context: ./god-scheduler
#       dockerfile: Dockerfile
#     container_name: godscheduler
#     ports:
#       - "3000:3000"
#     environment:
#       - WATCHPACK_POLLING=true # Mac/Windowsã§ã®å¤‰æ›´æ¤œçŸ¥ã‚’å¼·åŒ–
#     depends_on:
#       - api
#     # ğŸ‘‡ ã“ã“ãŒãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã®è‚ï¼
#     volumes:
#       - ./god-scheduler:/app
#       - /app/node_modules
#       - /app/.next

# volumes:
#   sql_data_edge:

services:
 # 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (æœ¬å®¶ SQL Server 2022 - äº’æ›ãƒ¢ãƒ¼ãƒ‰)
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    # ğŸ‘‡ ã“ã‚ŒãŒå®‰å®šå‹•ä½œã®éµãƒã‚¤ï¼
    platform: linux/amd64
    container_name: god_scheduler_db
    ports:
      - "1433:1433"
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_SA_PASSWORD=GodScheduler2026
    # å®‰å®šã™ã‚‹ã¾ã§ã¯ãƒœãƒªãƒ¥ãƒ¼ãƒ ãªã—ï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãªã—ï¼‰ã§ã„ããï¼
    # volumes:
    #   - sql_data_final:/var/opt/mssql/data

  # 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API (.NET)
  api:
    image: mcr.microsoft.com/dotnet/sdk:9.0
    container_name: god_scheduler_api
    ports:
      - "5078:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Server=db;Database=GodSchedulerDb;User Id=sa;Password=GodScheduler2026;TrustServerCertificate=True;
      - DOTNET_USE_POLLING_FILE_WATCHER=true
    depends_on:
      - db
    working_dir: /app
    command: dotnet watch run --urls=http://0.0.0.0:8080
    volumes:
      - ./GodScheduler.Api:/app
      - /app/obj
      - /app/bin

  # 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Next.js)
  web:
    build:
      context: ./god-scheduler
      dockerfile: Dockerfile
    container_name: godscheduler
    ports:
      - "3000:3000"
    environment:
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
    depends_on:
      - api
    volumes:
      - ./god-scheduler:/app
      - /app/node_modules
      - /app/.next

# ä¸‹ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ å®šç¾©ã¯ã€ä½¿ã‚ãªã„ã‘ã©æ®‹ã—ã¦ãŠã„ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã«ã¯ãªã‚‰ã‚“
volumes:
  sql_data_edge: