services:
  # 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: god_scheduler_db
    environment:
      - ACCEPT_EULA=Y
      # ğŸ‘‡ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã“ã‚Œã«çµ±ä¸€ï¼
      - MSSQL_SA_PASSWORD=GodScheduler2026
    ports:
      - "1433:1433"
    volumes:
      # ğŸ‘‡ åå‰ã‚’ "sql_data_final" ã«å¤‰ãˆã¦ã€å¼·åˆ¶çš„ã«æ–°å“ã«ã™ã‚‹ï¼
      - sql_data_final:/var/opt/mssql

  # 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API (.NET)
  api:
    build:
      context: ./GodScheduler.Api
      dockerfile: Dockerfile
    container_name: god_scheduler_api
    ports:
      - "5078:8080"
    environment:
      # ğŸ‘‡ Dockerå†…ã§ã¯ç’°å¢ƒå¤‰æ•°ã§ä¸Šæ›¸ã (Macå´ã¨å¹²æ¸‰ã•ã›ãªã„)
      - ConnectionStrings__DefaultConnection=Server=db;Database=GodSchedulerDb;User Id=sa;Password=GodScheduler2026;TrustServerCertificate=True;
    depends_on:
      - db
    # ğŸ‘‡ã€New!ã€‘ã“ã“ãŒ Watch ã®è¨­å®šãƒã‚¤ï¼
    develop:
      watch:
        # C#ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰ã‚ã£ãŸã‚‰ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã‚Šç›´ã—ã¦å†èµ·å‹• (Rebuild)
        - action: rebuild
          path: ./GodScheduler.Api
          target: /src
          ignore:
            - bin/
            - obj/

  # 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Next.js)
  web:
    build:
      context: ./god-scheduler
      dockerfile: Dockerfile
    container_name: god_scheduler_web
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:5078
    depends_on:
      - api
    # ğŸ‘‡ã€New!ã€‘ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯çˆ†é€ŸåŒæœŸ (Sync) ãƒã‚¤ï¼
    develop:
      watch:
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰ã‚ã£ãŸã‚‰ã€ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã«å³è»¢é€ (Sync)
        - action: sync
          path: ./god-scheduler
          target: /app
          ignore:
            - node_modules/
            - .next/
        # package.json ãŒå¤‰ã‚ã£ãŸæ™‚ã ã‘ã¯ä½œã‚Šç›´ã— (Rebuild)
        - action: rebuild
          path: ./god-scheduler/package.json

volumes:
  # ğŸ‘‡ æ–°å“ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å®šç¾©
  sql_data_final: